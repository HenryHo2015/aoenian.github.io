<!DOCTYPE html>
<html lang="zh-CN">
<head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <title>
        
            CentOS7安装配置Samba
        
    </title>
    <link rel="icon" href="/img/favicon.png"/>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <link rel="stylesheet" href="/css/hljs.min.css">
    <script src="/js/hljs.min.js"></script>  
    <script src="/js/gitment.browser.js"></script>  
</head>
<body>
    <header class="header" id="header">
    <h1>
        <a class="title" href="/">
            aoenian&#39;s blog
        </a>
    </h1>
    <h2>
        <a class="motto">
            珍惜时间，浪费在爱的人和事上！
        </a>
    </h2>
    <nav class="navbar">
        <ul class="menu">
            
            
                <li class="menu-item">
                    <a href="/" class="menu-item-link">
                        Home
                    </a>
                </li>
            
                
            
                <li class="menu-item">
                    <a href="/archives/" class="menu-item-link">
                        Archives
                    </a>
                </li>
            
                
            
                <li class="menu-item">
                    <a href="/about/" class="menu-item-link">
                        About
                    </a>
                </li>
            
                
            
                <li class="menu-item">
                    <a href="https://github.com/aoenian" class="menu-item-link">
                        Github
                    </a>
                </li>
            
                
            
                
                
                <li class="menu-item">
                    <a class="menu-item-link search">
                        Search                   
                        <i class="fa fa-long-arrow-right search-icon" aria-hidden="true"></i>
                    </a>
                        <input placeholder="Search..." class="search-input" style="display:none;border:none!important;" onkeydown="onEnter(event)" onkeypress="onEnter(event)"></input>
                </li>
                
        </ul>
    </nav>
</header>
    <main class="main">
        <article class="post">
            <h1>
                <a class="title" href="/2017/10/29/centos7-samba/"> 
                    CentOS7安装配置Samba 
                </a>
            </h1>
            <div class="meta">
                <a class="date"> 
                    <i class="fa fa-calendar" aria-hidden="true"></i>                    
                    2017-10-29   
                </a>
                
                <a class="category">
                    <i class="fa fa-th" aria-hidden="true"></i>  
                </a>
               
                <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CentOS/">CentOS</a></li></ul>
                
                <a class="tag">
                    <i class="fa fa-tags" aria-hidden="true"></i>  
                </a>
                
                    <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CentOS/">CentOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Samba/">Samba</a></li></ul>
            </div>
<div class="toc">
  <ol class="toc-list"><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#sec-1"><span class="toc-list-text">前言</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#sec-1-1"><span class="toc-list-text">需求</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#sec-1-2"><span class="toc-list-text">安装ntfs-3g</span></a></li></ol></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#sec-2"><span class="toc-list-text">安装配置Samba</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#sec-2-1"><span class="toc-list-text">安装Samba</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#sec-2-2"><span class="toc-list-text">配置一个完全权限的共享目录</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-4"><a class="toc-list-link" href="#sec-2-2-1"><span class="toc-list-text">查看windows的工作组</span></a></li><li class="toc-list-item toc-list-level-4"><a class="toc-list-link" href="#sec-2-2-2"><span class="toc-list-text">配置Samba</span></a></li><li class="toc-list-item toc-list-level-4"><a class="toc-list-link" href="#sec-2-2-3"><span class="toc-list-text">重启smaba</span></a></li></ol></li></ol></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#sec-3"><span class="toc-list-text">参考</span></a></li></ol>
</div>
            <div class="content">
                



<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">前言</h2>
<div class="outline-text-2" id="text-1">
<p>
<i>性子急的可以跳过，直接看后面的配置</i>
</p>
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">需求</h3>
<div class="outline-text-3" id="text-1-1">
<p>
树莓派安装了CentOS7以后感觉还不错，正好大部分学习linux的资料都是CentOS为主，所以就准备长期使用，然后这两天用you-get下载了一些视频，然后想拷贝出来，这时候突然发现CentOS不能写入ntfs格式的U盘，哎，开源和微软之间总有那么一道肉隐肉现的鸿沟。
</p>

<p>
那么需求来了，让CentOS读取ntfs，搜索一番，发现很简单就是安装一个ntfs-3g的软件的事情，不过就这么个问题废老大劲了。
</p>

<a id="more"></a>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">安装ntfs-3g</h3>
<div class="outline-text-3" id="text-1-2">
<p>
首先需要安装epel，至于epel是个什么货色请看<a href="https://fedoraproject.org/wiki/EPEL/zh-cn" target="_blank" rel="noopener">EPEL</a>. <i>结果悲惨的失败了</i>
</p>

<ul class="org-ul">
<li>网络安装
</li>
</ul>

<p>
本来CentOS7应该可以直接用命令安装 <code>yum install epel-release</code> ，但是就是没有这个软件包，我也纳闷了，还觉得写博客的这些都什么人，自己也不试试。换个方法呗，难不倒咱们。
</p>

<ul class="org-ul">
<li>软件包安装
</li>
</ul>

<div class="org-src-container">

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## RHEL/CentOS 7 64-Bit ##</span></span><br><span class="line"><span class="comment"># wget http://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-10.noarch.rpm</span></span><br><span class="line"><span class="comment"># rpm -ivh epel-release-7-10.noarch.rpm</span></span><br></pre></td></tr></table></figure>
</div>

<p>
安装没报错，但是更新软件源的时候就出错了，搜了半天发现，可能CentOS7是32位版本的原因。
</p>

<ul class="org-ul">
<li>查看CentOS的版本
</li>
</ul>

<div class="org-src-container">

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS-rpi3 aoenian]<span class="comment"># cat /proc/version</span></span><br><span class="line">Linux version <span class="number">4.9</span>.<span class="number">50</span>-v7.<span class="number">1</span>.el7 (mockbuild@armv7-<span class="number">03</span>.dev.CentOS.org) (gcc version <span class="number">4.8</span>.<span class="number">5</span> <span class="number">20150623</span> (Red Hat <span class="number">4.8</span>.<span class="number">5</span>-<span class="number">16</span>) (GCC) ) <span class="comment">#1 SMP Thu Sep 14 08:17:16 UTC 2017</span></span><br><span class="line"></span><br><span class="line">[root@CentOS-rpi3 aoenian]<span class="comment"># uname -a</span></span><br><span class="line">Linux CentOS-rpi3 <span class="number">4.9</span>.<span class="number">50</span>-v7.<span class="number">1</span>.el7 <span class="comment">#1 SMP Thu Sep 14 08:17:16 UTC 2017 armv7l armv7l armv7l GNU/Linux</span></span><br><span class="line"></span><br><span class="line">[root@CentOS-rpi3 aoenian]<span class="comment"># uname -r</span></span><br><span class="line"><span class="number">4.9</span>.<span class="number">50</span>-v7.<span class="number">1</span>.el7</span><br><span class="line"></span><br><span class="line">[root@CentOS-rpi3 aoenian]<span class="comment"># cat /etc/redhat-release</span></span><br><span class="line">CentOS Linux release <span class="number">7.4</span>.<span class="number">1708</span> (Core)</span><br><span class="line"></span><br><span class="line">[root@CentOS-rpi3 aoenian]<span class="comment"># getconf LONG_BIT</span></span><br><span class="line"><span class="number">32</span></span><br><span class="line"></span><br><span class="line">[root@CentOS-rpi3 aoenian]<span class="comment"># file /bin/ls</span></span><br><span class="line">/bin/ls: ELF <span class="number">32</span>-bit LSB executable, ARM, version <span class="number">1</span> (SYSV), dynamically linked (uses shared libs), <span class="keyword">for</span> GNU/Linux <span class="number">2.6</span>.<span class="number">32</span>, BuildID[sha1]=c591c4039d5eb3301eb8be1fa4ebaed8<span class="built_in">cd</span>832240, stripped</span><br></pre></td></tr></table></figure>
</div>

<p>
一看完了，树莓派的CentOS7是32位，而且从7开始官方不再支持32位的epel了。
</p>

<ul class="org-ul">
<li>不能放弃，安装CentOS6的32位epel
</li>
</ul>

<div class="org-src-container">

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## RHEL/CentOS 6 32-Bit ##</span></span><br><span class="line"><span class="comment"># wget http://download.fedoraproject.org/pub/epel/6/i386/epel-release-6-8.noarch.rpm</span></span><br><span class="line"><span class="comment"># rpm -ivh epel-release-6-8.noarch.rpm</span></span><br><span class="line"><span class="comment">## RHEL/CentOS 6 64-Bit ##</span></span><br><span class="line"><span class="comment"># wget http://download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</span></span><br><span class="line"><span class="comment"># rpm -ivh epel-release-6-8.noarch.rpm</span></span><br></pre></td></tr></table></figure>
</div>

<p>
装了以后发现，一样不管用，及时止损，不再尝试了，不过网络上有人写到安装成功，不过不是树莓派的，是PC的。
</p>

<p>
<i>CentOS7 32位的安装epel，请死了这条心</i> 不过本来32位也就被淘汰了，给自己个理由换电脑吧。
</p>
</div>
</div>
</div>


<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">安装配置Samba</h2>
<div class="outline-text-2" id="text-2">
<p>
既然上面的路堵死了，那么就来只能共享吧。CentOS的共享比较麻烦具体下面介绍。
</p>
</div>

<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">安装Samba</h3>
<div class="outline-text-3" id="text-2-1">
<p>
先查看是否安装Samba
</p>

<div class="org-src-container">

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa | grep samba</span><br><span class="line">yum list installed | grep samba</span><br></pre></td></tr></table></figure>
</div>

<p>
如果已经安装那么可以先卸载（这里的命令选用，如果觉得已经安装正确则无需卸载）
</p>

<div class="org-src-container">

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum remove samba*</span><br></pre></td></tr></table></figure>
</div>

<p>
接着，连上网络，安装samba
</p>

<div class="org-src-container">

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum install samba* -y</span><br></pre></td></tr></table></figure>
</div>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">配置一个完全权限的共享目录</h3>
<div class="outline-text-3" id="text-2-2">
</div><div id="outline-container-sec-2-2-1" class="outline-4">
<h4 id="sec-2-2-1">查看windows的工作组</h4>
<div class="outline-text-4" id="text-2-2-1">
<p>
打开win的cmd窗口，快捷键 win+r 然后输入 cmd 回车即可，并在窗口输入以下命令
</p>

<div class="org-src-container">

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">net config workstation</span><br></pre></td></tr></table></figure>
</div>

<p>
找到 <code>Workstation domain</code> 一行，值应该是 <code>WORKGROUP</code> 下面配置Samba要用到
</p>
</div>
</div>

<div id="outline-container-sec-2-2-2" class="outline-4">
<h4 id="sec-2-2-2">配置Samba</h4>
<div class="outline-text-4" id="text-2-2-2">
<ul class="org-ul">
<li>创建共享目录
</li>
</ul>

<div class="org-src-container">

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /samba/anonymous</span><br><span class="line">chmod -R <span class="number">0777</span> /samba/anonymous</span><br><span class="line">chown -R nobody:nobody /samba/anonymous</span><br></pre></td></tr></table></figure>
</div>

<ul class="org-ul">
<li>关掉防火墙和selinux
</li>
</ul>

<div class="org-src-container">

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld.service <span class="comment">#停止firewall</span></span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld.service <span class="comment">#禁止firewall开机启动</span></span><br><span class="line"></span><br><span class="line">setenforce <span class="number">0</span>    <span class="comment"># 关闭selinux</span></span><br><span class="line">getenforce      <span class="comment"># 查看selinux的状态，应该是 Permissive</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 彻底禁用selinux 编辑配置文件</span></span><br><span class="line">vim /etc/sysconfig/selinux    </span><br><span class="line"><span class="comment"># 修改SELINUX</span></span><br><span class="line">SELINUX=disabled</span><br></pre></td></tr></table></figure>
</div>

<p>
<i>如果防火墙不关闭，查看共享会出现连接失败；如果selinux不关闭，则无法看到共享目录的内容</i>
</p>

<p>
<i>当然为了安全期间，可以对Samba的端口放行，设置selinux分享Samba的目录，大家可以参考博文</i>
</p>

<ul class="org-ul">
<li>备份配置文件
</li>
</ul>

<div class="org-src-container">

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">cp /etc/samba/smb.conf /etc/samba/smb.conf.bak</span><br></pre></td></tr></table></figure>
</div>

<ul class="org-ul">
<li>修改配置文件
</li>
</ul>

<div class="org-src-container">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/samba/smb.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以把之前的内容注释掉，加入如下内容</span></span><br><span class="line">[<span class="keyword">global</span>]</span><br><span class="line">	workgroup = WORKGROUP    <span class="comment"># 跟win的工作组同名</span></span><br><span class="line">	server string = Samba Server Version %v    <span class="comment"># 服务器描述</span></span><br><span class="line">	netbios name = CentOS    <span class="comment"># 共享服务器在网络上显示的名字</span></span><br><span class="line">	security = user    <span class="comment"># 使用 SAMBA 服务器本身的密码数据库</span></span><br><span class="line">	<span class="comment"># 将所有Samba系统主机所不能正确识别的用户都映射成guest用户</span></span><br><span class="line">	map to guest = bad user    </span><br><span class="line">	dns proxy = no</span><br><span class="line">	log file = /var/log/samba/log.%m    <span class="comment"># 日志文件位置</span></span><br><span class="line">	max log size = <span class="number">50</span>    <span class="comment"># 日志大小</span></span><br><span class="line"></span><br><span class="line">[Anonymous]</span><br><span class="line">	comment = Anonymous File Server Share</span><br><span class="line">	path = /samba/anonymous</span><br><span class="line">	browsable = yes    <span class="comment"># 让所有的用户看到这个项目</span></span><br><span class="line">	writable = yes    <span class="comment"># 是否可以写入</span></span><br><span class="line">	guest ok = yes    <span class="comment"># 是否允许guest账户访问</span></span><br><span class="line">	read only = no    <span class="comment"># 是否只读，与wirtable类似，谁在后面厅听谁的</span></span><br></pre></td></tr></table></figure>
</div>

<p>
<i>保存配置文件，并退出，到此一个完全共享的目录基本配置完毕</i>
</p>
</div>
</div>

<div id="outline-container-sec-2-2-3" class="outline-4">
<h4 id="sec-2-2-3">重启smaba</h4>
<div class="outline-text-4" id="text-2-2-3">
<div class="org-src-container">

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> smb.service    <span class="comment"># 加入开机启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> nmb.service</span><br><span class="line">systemctl restart smb.service</span><br><span class="line">systemctl restart nmb.service</span><br></pre></td></tr></table></figure>
</div>

<p>
<i>配置完成，可查看共享目录和文件</i>
</p>
</div>
</div>
</div>
</div>



<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">参考</h2>
<div class="outline-text-2" id="text-3">
<ul class="org-ul">
<li><a href="https://lintut.com/easy-samba-installation-on-rhel-centos-7/" target="_blank" rel="noopener">Easy Samba installation on RHEL/CentOS 7</a>
</li>
<li><a href="https://www.unixmen.com/install-configure-samba-server-centos-7/" target="_blank" rel="noopener">Install And Configure Samba Server In CentOS 7</a>
</li>
<li><a href="http://billtym.blog.51cto.com/1745172/569551" target="_blank" rel="noopener">Samba常用配置及GUEST访问</a>
</li>
<li><a href="https://wiki.centos.org/zh/HowTos/SetUpSamba" target="_blank" rel="noopener">设置 SAMBA</a>
</li>
<li><a href="http://cn.linux.vbird.org/linux_server/0370samba_2.php" target="_blank" rel="noopener">鸟哥文件服务器</a>
</li>
</ul>
</div>
</div>

Last Updated 2018-05-01 二 18:20.<br>Render by <a href="https://github.com/CodeFalling/hexo-renderer-org" target="_blank" rel="noopener">hexo-renderer-org</a> with <a href="http://www.gnu.org/software/emacs/" target="_blank" rel="noopener">Emacs</a> 25.3.1 (<a href="http://orgmode.org" target="_blank" rel="noopener">Org</a> mode 8.2.10)

            </div>
          
           
            <div class="copyright">
                <div class="name">
                    <a>本文作者:</a>
                    <a>aoenian</a>
                </div>
                <div class="link">
                    <a>本文链接:</a>
                    <a class="permalink" href="https://aoenian.github.io/2017/10/29/centos7-samba/">https://aoenian.github.io/2017/10/29/centos7-samba/</a>
                </div>
                <div class="license">
                    <a>版权声明:</a>
                    <a>本博客所有文章除特别声明外，均采用许可协议 CC BY-NC-SA 3.0 CN。转载请注明出处！</a>
                </div>
            </div>
            

          


</article>


<div class="more">

    <div class="prev">
   <a href="/2017/11/02/suid-test/">  文件特殊权限SUID测试</a>
    </div>

<div></div>

    <div class="next">
    <a href="/2017/04/29/website-collect/"> 一些好的网站备份 </a>
    </div>
    
</div>

<div class="bdsharebuttonbox">
<a href="#" class="bds_weixin fa fa-weixin" data-cmd="weixin" title="分享到微信" style="color:#1cbd8f">
</a>
<a href="#" class="bds_tsina fa fa-weibo" data-cmd="tsina" title="分享到新浪微博" style="color:#ff6363">
</a>
<a href="#" class="bds_twi fa fa-twitter" data-cmd="twi" title="分享到Twitter" style="color:#00A7EB">
</a>
<a href="#" class="bds_fbook fa fa-facebook" data-cmd="fbook" title="分享到Facebook" style="color:#00A7EB">
</a>
</div>
<script>
window._bd_share_config={
    "common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"16"},
    "share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='../../../../../static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>
 
<div id="comments"></div>

<script>
    var gitment = new Gitment({
    id: "Sun Oct 29 2017 00:00:00 GMT+0800",
    owner: "",
    repo: "",
    oauth: {
      client_id:"",
      client_secret: "",
    }
  })
  gitment.render('comments')
</script>
    </main>
    <a class="not-found">not found!</a>
    <div class="search-items">
    </div>
    <a href="#header" id="top" style="display:none">
        <i class="fa fa-sort-asc fa-2x"></i>
    </a>
    <footer class="footer">
    <div class="footer-copyright">©️2017
    <a href="//github.com/Vevlins/toki" class="link" target="_blank">Toki</a>  by Vevlins
    </div>
</footer>

    <script src="/js/jquery.js"></script>
    <script src="/js/toki.js"></script>  
  <script>hljs.initHighlightingOnLoad();</script>
</body>
</html>