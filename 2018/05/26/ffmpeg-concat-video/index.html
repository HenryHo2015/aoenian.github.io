<!DOCTYPE html>
<html lang="zh-CN">
<head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <title>
        
            ffmpeg剪切连接音视频
        
    </title>
    <link rel="icon" href="/img/favicon.png"/>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <link rel="stylesheet" href="/css/hljs.min.css">
    <script src="/js/hljs.min.js"></script>  
    <script src="/js/gitment.browser.js"></script>  
</head>
<body>
    <header class="header" id="header">
    <h1>
        <a class="title" href="/">
            aoenian&#39;s blog
        </a>
    </h1>
    <h2>
        <a class="motto">
            珍惜时间，浪费在爱的人和事上！
        </a>
    </h2>
    <nav class="navbar">
        <ul class="menu">
            
            
                <li class="menu-item">
                    <a href="/" class="menu-item-link">
                        Home
                    </a>
                </li>
            
                
            
                <li class="menu-item">
                    <a href="/archives/" class="menu-item-link">
                        Archives
                    </a>
                </li>
            
                
            
                <li class="menu-item">
                    <a href="/about/" class="menu-item-link">
                        About
                    </a>
                </li>
            
                
            
                <li class="menu-item">
                    <a href="https://github.com/aoenian" class="menu-item-link">
                        Github
                    </a>
                </li>
            
                
            
                
                
                <li class="menu-item">
                    <a class="menu-item-link search">
                        Search                   
                        <i class="fa fa-long-arrow-right search-icon" aria-hidden="true"></i>
                    </a>
                        <input placeholder="Search..." class="search-input" style="display:none;border:none!important;" onkeydown="onEnter(event)" onkeypress="onEnter(event)"></input>
                </li>
                
        </ul>
    </nav>
</header>
    <main class="main">
        <article class="post">
            <h1>
                <a class="title" href="/2018/05/26/ffmpeg-concat-video/"> 
                    ffmpeg剪切连接音视频 
                </a>
            </h1>
            <div class="meta">
                <a class="date"> 
                    <i class="fa fa-calendar" aria-hidden="true"></i>                    
                    2018-05-26   
                </a>
                
                <a class="category">
                    <i class="fa fa-th" aria-hidden="true"></i>  
                </a>
               
                <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/FFmpeg/">FFmpeg</a></li></ul>
                
                <a class="tag">
                    <i class="fa fa-tags" aria-hidden="true"></i>  
                </a>
                
                    <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/concat/">concat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ffmpeg/">ffmpeg</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/split/">split</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/video/">video</a></li></ul>
            </div>
<div class="toc">
  <ol class="toc-list"><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#sec-1"><span class="toc-list-text">FFmpeg</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#sec-1-1"><span class="toc-list-text">音频</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#sec-1-2"><span class="toc-list-text">视频</span></a></li></ol></li></ol>
</div>
            <div class="content">
                

<p>
这几天需要处理一下视频，开始以为只是简单的剪切和连接，没想到耗费了很多时间，现在把使用的方法总结出来，以后就不用重复寻找。
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">FFmpeg</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">音频</h3>
<div class="outline-text-3" id="text-1-1">
<p>
平时用音频操作基本就是剪切制作手机铃声，所以就只记录剪切的方法
</p>

<p>
<code>ffmpeg -i input.mp3 -ss 00:01:12 -t 00:01:42 -acodec copy output.mp3</code>
</p>

<a id="more"></a>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">视频</h3>
<div class="outline-text-3" id="text-1-2">
<p>
<b>剪切</b>
</p>

<p>
<code>ffmpeg -i input.mp4 -ss STARTTIME -t STOPTIME -acodec copy -vcodec copy output.mp4</code>
</p>

<p>
<b>STARTTIME/STOPTIME</b> 格式可以有两种：
</p>
<ol class="org-ol">
<li>以秒为单位，直接写数字即可
</li>
<li>时:分:秒    01:02:03
</li>
</ol>

<p>
如果需要对视频编辑，建议使用软件，这里推荐 <a href="https://www.shotcut.org/" target="_blank" rel="noopener">Shotcut</a> ，或者从 <a href="https://zhuanlan.zhihu.com/p/21879714" target="_blank" rel="noopener">这里</a> 找找适合的。
</p>

<p>
<b>连接</b>
</p>

<p>
连接比较复杂，这里分情况介绍。
</p>

<ol class="org-ol">
<li>视频是由同一个设备录制，其实就是视频的码率，声音，宽高等要素全部一样，这样连接比较简单
<ul class="org-ul">
<li>文件方法  <a href="https://segmentfault.com/a/1190000000414341" target="_blank" rel="noopener">原文</a>
</li>
</ul>
<div class="org-src-container">

<figure class="highlight"><table><tr><td class="code"><pre><span class="line"># &#22522;&#26412;&#23601;&#26159;&#25226;&#24819;&#35201;&#36830;&#25509;&#30340;&#35270;&#39057;&#30340;&#36335;&#24452;&#20889;&#22312;&#19968;&#20010;&#25991;&#26412;&#25991;&#20214;&#20013;&#65292;&#28982;&#21518;&#29992;&#21629;&#20196;&#36830;&#25509;&#65292;&#36866;&#21512;&#36830;&#25509;&#25991;&#20214;&#36739;&#22810;&#30340;&#24773;&#20917;&#10;$ cat mylist.txt&#10;file &#39;/path/to/file1&#39;&#10;file &#39;/path/to/file2&#39;&#10;file &#39;/path/to/file3&#39;&#10;$ ffmpeg -f concat -i mylist.txt -c copy output</span><br></pre></td></tr></table></figure>
</div>
<ul class="org-ul">
<li>直接命令方法
</li>
</ul>
<div class="org-src-container">

<figure class="highlight"><table><tr><td class="code"><pre><span class="line"># &#36830;&#25509;&#25991;&#20214;&#36739;&#23569;&#27604;&#36739;&#21512;&#36866;&#10;ffmpeg -i &#34;concat:input1.mp4|input2.mp4|input3.mp4&#34; -c copy output.mp4</span><br></pre></td></tr></table></figure>
</div>
</li>

<li>视频虽然格式相同，如都是MP4，但是码率，宽高都不相同，这就比较麻烦，还没有好的解决方法，以下仅供参考 <i>如果大家有解决方案，请麻烦告诉一下</i>

<p>
在网络上搜索的这种情况，基本思路就是把视频转换到临时格式，合并后再转换回源格式
</p>

<ul class="org-ul">
<li>使用ts格式过渡 <a href="https://superuser.com/a/1059261" target="_blank" rel="noopener">原文</a>
</li>
</ul>
<div class="org-src-container">

<figure class="highlight"><table><tr><td class="code"><pre><span class="line">ffmpeg -i input1.mp4 -c copy -bsf:v h264_mp4toannexb -f mpegts intermediate1.ts&#10;ffmpeg -i input2.mp4 -c copy -bsf:v h264_mp4toannexb -f mpegts intermediate2.ts&#10;ffmpeg -i &#34;concat:intermediate1.ts|intermediate2.ts&#34; -c copy -bsf:a aac_adtstoasc output.mp4</span><br></pre></td></tr></table></figure>
</div>
<p>
<i>这种方法可以完成视频的连接，画面没有问题，但是视频的声音会丢失</i>
</p>

<ul class="org-ul">
<li>使用mpg格式过渡 <a href="https://stackoverflow.com/a/7333453" target="_blank" rel="noopener">原文</a>
</li>
</ul>
<div class="org-src-container">

<figure class="highlight"><table><tr><td class="code"><pre><span class="line">ffmpeg -i 1.mp4 -qscale 0 1.mpg&#10;ffmpeg -i 2.mp4 -qscale 0 2.mpg&#10;cat 1.mpg 2.mpg | ffmpeg -f mpeg -i - -qscale 0 -vcodec mpeg4 output.mp4</span><br></pre></td></tr></table></figure>
</div>
<p>
<i>视频可以连接，声音还在，不过视频会压缩为一样的宽高</i>
</p>

<ul class="org-ul">
<li>最后是我已经实验过的几种转换方法和连接方法，不过都失败了
</li>
</ul>
<p>
<code>ffmpeg -i 2.mp4 -f lavfi -i anullsrc -c:v copy -c:a aac -shortest 2.ts</code> 
<a href="https://superuser.com/a/1029552" target="_blank" rel="noopener">原文</a> 这个命令转换的 <code>ts</code> 文件连接后部分视频会有声音，不过部分会丢失，我查看了转换后的 <code>ts</code> 文件，发现有的转换为 <code>ts</code> 文件后声音就没有了。
</p>

<p>
<code>cat 1.ts 2.ts &gt;all.ts ffmpeg -i all.ts -c copy all.mp4</code> 
<a href="https://video.stackexchange.com/a/20074" target="_blank" rel="noopener">原文</a> 另一种连接方法，比较简单，能够连接不过效果和之前的方式相同，没有声音
</p>

<p>
<code>ffmpeg -i infilename -f mpegts -vcodec copy -acodec copy outfile.ts</code> 
<a href="https://superuser.com/q/227036" target="_blank" rel="noopener">原文</a> 这种方式转换后的 <code>ts</code> 文件有声音，不过连接后还是不行。
</p>
</li>
</ol>
</div>
</div>
</div>

Last Updated 2018-05-27 日 21:05.<br>Render by <a href="https://github.com/CodeFalling/hexo-renderer-org" target="_blank" rel="noopener">hexo-renderer-org</a> with <a href="http://www.gnu.org/software/emacs/" target="_blank" rel="noopener">Emacs</a> 25.3.1 (<a href="http://orgmode.org" target="_blank" rel="noopener">Org</a> mode 8.2.10)

            </div>
          
           
            <div class="copyright">
                <div class="name">
                    <a>本文作者:</a>
                    <a>aoenian</a>
                </div>
                <div class="link">
                    <a>本文链接:</a>
                    <a class="permalink" href="https://aoenian.github.io/2018/05/26/ffmpeg-concat-video/">https://aoenian.github.io/2018/05/26/ffmpeg-concat-video/</a>
                </div>
                <div class="license">
                    <a>版权声明:</a>
                    <a>本博客所有文章除特别声明外，均采用许可协议 CC BY-NC-SA 3.0 CN。转载请注明出处！</a>
                </div>
            </div>
            

          


</article>


<div class="more">

<div></div>

    <div class="next">
    <a href="/2018/05/20/raspi-version/"> 查看树莓派版本 </a>
    </div>
    
</div>

<div class="bdsharebuttonbox">
<a href="#" class="bds_weixin fa fa-weixin" data-cmd="weixin" title="分享到微信" style="color:#1cbd8f">
</a>
<a href="#" class="bds_tsina fa fa-weibo" data-cmd="tsina" title="分享到新浪微博" style="color:#ff6363">
</a>
<a href="#" class="bds_twi fa fa-twitter" data-cmd="twi" title="分享到Twitter" style="color:#00A7EB">
</a>
<a href="#" class="bds_fbook fa fa-facebook" data-cmd="fbook" title="分享到Facebook" style="color:#00A7EB">
</a>
</div>
<script>
window._bd_share_config={
    "common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"16"},
    "share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='../../../../../static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>
 
<div id="comments"></div>

<script>
    var gitment = new Gitment({
    id: "Sat May 26 2018 00:00:00 GMT+0800",
    owner: "",
    repo: "",
    oauth: {
      client_id:"",
      client_secret: "",
    }
  })
  gitment.render('comments')
</script>
    </main>
    <a class="not-found">not found!</a>
    <div class="search-items">
    </div>
    <a href="#header" id="top" style="display:none">
        <i class="fa fa-sort-asc fa-2x"></i>
    </a>
    <footer class="footer">
    <div class="footer-copyright">©️2017
    <a href="//github.com/Vevlins/toki" class="link" target="_blank">Toki</a>  by Vevlins
    </div>
</footer>

    <script src="/js/jquery.js"></script>
    <script src="/js/toki.js"></script>  
  <script>hljs.initHighlightingOnLoad();</script>
</body>
</html>